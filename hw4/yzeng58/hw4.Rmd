---
title: "hw4"
author: "Yuchen Zeng"
date: "9/28/2019"
output: html_document
---

# Name: Yuchen Zeng
# Netid: yzeng58@wisc.edu

## Summary
First problem I met is loading R in CHTC. Then I figured it out by copying the examples our instructor provided. Then I wrote hw4.R, hw4_1job.R, hw4_5jobs.R. Another big issue is that I do not know how to do arithmetic operation in .sub file, while coding hw4_5jobs.R. I searched on the Internet, and finally found the solution. Additionally, I got a lot of holds when I first submitted hw4.sub. Then I found the name of the .tgz files are not successive. Actually, I also met many other little issues during debugging. Some of them are solved by google, and the rest of them are solved just by checking the .out and .err. Finally, I merged the .csv file and download the first ten .fit with shortest distance.

```{r}
detect = read.csv("hw4best100.csv", header = TRUE)
```

## Date Processing

```{r}
require(ggplot2)
require(astro)
wd = getwd()
template = read.fitstab("cB58_Lyman_break.fit")
target = template[,2]
setwd(paste(getwd(),"/data",sep=""))
spectrum.id = list.files()
spectrum = lapply(spectrum.id,FUN=read.fitstab)
setwd(wd)
```

## Figures Drawing
```{r}
for (i in 1:10){
  spec1 = read.fitstab(paste("data/",as.character(detect$spectrumID[i]),sep=""))
  figure1 = data.frame(x = c(1:dim(spec1)[1], 1:dim(spec1)[1]), 
                     y = c(scale(spec1[,1]),c(rep(0,detect[1,3]-1),scale(target),rep(0,dim(spec1)[1]-length(target)-detect[1,3]+1))),
  spectrum = c(rep(as.character(detect$spectrumID[i]), dim(spec1)[1]), rep("cB58_Lyman_break.fit", dim(spec1)[1])))

  print(ggplot(data=figure1, aes(x = x, y = y, color = spectrum))+geom_line()+
          labs(x="shifted wavelength", y = "rescaled flux"))
}
```


